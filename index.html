<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Feedback Form</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 30px;
      background: linear-gradient(to right, #89f7fe, #66a6ff);
      min-height: 100vh;
    }

    h1 {
      color: #ffffff;
      text-align: center;
      margin-bottom: 30px;
      text-shadow: 1px 1px 3px rgba(0,0,0,0.2);
    }

    form {
      background: #e0f7fa;
      padding: 25px 30px;
      border-radius: 15px;
      max-width: 500px;
      margin: 0 auto;
      box-shadow: 0 8px 16px rgba(0,0,0,0.2);
    }

    label {
      display: block;
      margin: 10px 0 5px;
      color: #006064;
      font-weight: bold;
    }

    input, textarea {
      width: 100%;
      padding: 10px;
      margin-bottom: 15px;
      border: 1px solid #b2ebf2;
      border-radius: 8px;
      background: #ffffff;
    }

    button[type="submit"] {
      background: #00bcd4;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      transition: background 0.3s ease;
    }

    button[type="submit"]:hover {
      background: #008ba3;
    }

    #messageBox {
      text-align: center;
      margin-top: 15px;
      font-weight: bold;
    }

    #viewBtn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      padding: 10px 20px;
      background: #ff4081;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    }

    #viewBtn:hover {
      background-color: #e91e63;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 30px;
      background: white;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    th, td {
      border: 1px solid #ddd;
      padding: 12px;
      text-align: left;
    }

    th {
      background-color: #00bcd4;
      color: white;
    }

    #feedbackTableContainer {
      margin-top: 40px;
      max-width: 90%;
      margin-left: auto;
      margin-right: auto;
    }
  </style>
</head>
<body>

<h1>Feedback Form</h1>

<form id="feedbackForm">
  <label for="name">Name</label>
  <input type="text" name="name" required />

  <label for="email">Email</label>
  <input type="email" name="email" required />

  <label for="subject">Subject</label>
  <input type="text" name="subject" required />

  <label for="message">Message</label>
  <textarea name="message" rows="4" required></textarea>

  <button type="submit">Submit</button>
  <div id="messageBox"></div>
</form>

<!-- View Button -->
<button id="viewBtn">View Submissions</button>

<!-- Feedback Table Container -->
<div id="feedbackTableContainer" style="display: none;"></div>

<script>
const form = document.getElementById("feedbackForm");
const messageBox = document.getElementById("messageBox");

form.addEventListener("submit", async (e) => {
  e.preventDefault();

  const name = form.name.value.trim();
  const email = form.email.value.trim();
  const subject = form.subject.value.trim();
  const message = form.message.value.trim();

  if (!name || !email || !subject || !message) {
    alert("Please fill in all fields.");
    return;
  }

  if (!email.includes("@") || !email.includes(".")) {
    alert("Please enter a valid email address.");
    return;
  }

  if (message.length < 10) {
    alert("Message must be at least 10 characters.");
    return;
  }

  try {
    const res = await fetch("/submit-feedback", {
      method: "POST",
      headers: { "Content-Type": "application/x-www-form-urlencoded" },
      body: new URLSearchParams({ name, email, subject, message })
    });

    const data = await res.json();
    messageBox.textContent = data.message;
    messageBox.style.color = "green";
    form.reset();
  } catch (err) {
    messageBox.textContent = "❌ Something went wrong. Please try again.";
    messageBox.style.color = "red";
  }
});

// View submissions
document.getElementById("viewBtn").addEventListener("click", async () => {
  const container = document.getElementById("feedbackTableContainer");

  if (container.style.display === "block") {
    container.style.display = "none";
    return;
  }

  try {
    const response = await fetch('/api/feedback');
    const data = await response.json();

    let html = `
      <h2 style="text-align:center; color:#006064;">Submitted Feedback</h2>
      <table>
        <thead>
          <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Subject</th>
            <th>Message</th>
          </tr>
        </thead>
        <tbody>
          ${data.map(row => `
            <tr>
              <td>${row.name}</td>
              <td>${row.email}</td>
              <td>${row.subject}</td>
              <td>${row.message}</td>
            </tr>
          `).join('')}
        </tbody>
      </table>
    `;

    container.innerHTML = html;
    container.style.display = "block";
  } catch (err) {
    container.innerHTML = "<p style='color:red;'>❌ Could not load feedback.</p>";
    container.style.display = "block";
    console.error("Fetch error:", err);
  }
});
</script>

</body>
</html>